## 什么是中间件

从概念上讲，中间件是一种功能的封装方式，具体来说就是封装在程序中处理HTTP请求的功能。

中间件实在管道中执行的。在Express中通过调用`app.use`向管道中插入中间件。在Express中，中间件是一个有三个参数的函数：一个请求对象，一个响应对象，一个next的函数。

在Express4.0中，中间件和路由处理器是按它们的炼乳顺序调用的顺序更清晰。

在管道的最后放一个捕获一切请求的处理器是常见的做法，由他来处理跟前面其他所有路由都不匹配的请求。这个中间件一般会返回404。

如果中间件不调用`next()`，那么请求就在中间件中终止了。

## Express中间件重点

- 路由处理器（app.get、app.post等，经常被统称为app.VERB）可以被看做只处理特定HTTP谓词的中间件。同样，也可以将中间件看做可以处理全部HTTP谓词的路由处理器。

- 路由处理器的第一个参数必须是路径。如果想让某个路由匹配所有路径，只需用`/*`。中间件也可以将路径作为第一个参数但是是可选的（忽略则匹配所有路径）。

- 路由处理器和中间件的参数都有回调函数。如果有错误参数，就变成了错误处理中间件。

- 如果不调用`next()`，管道就会被终止，也不会再有处理器或中间件做后续处理。

- 如果调用了`next()`，一般不宜再发送响应到客户端。如果发送了，管道中后续的中间件或路由处理器还会执行，但它们发送的任何响应都会被忽略。

- 中间件必须是一个函数
